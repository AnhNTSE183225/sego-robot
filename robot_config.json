{
    "_comment": "Robot configuration file - all settings in one place",
    "robot": {
        "id": "3162d037-b3c1-49a0-ac24-da9f5a569213"
    },
    "serial": {
        "port": "/dev/ttyAMA0",
        "baud_rate": 115200
    },
    "lidar": {
        "port": "/dev/ttyUSB0",
        "front_offset_deg": 119.0
    },
    "kafka": {
        "bootstrap_servers": "192.168.1.14:9092",
        "topic_command": "robot.cmd",
        "topic_telemetry": "robot.telemetry",
        "topic_map": "robot.map",
        "topic_events": "robot.events"
    },
    "logging": {
        "file": "robot.log",
        "level": "INFO",
        "disable_file": true
    },
    "motion": {
        "distance_tolerance_m": 0.02,
        "poi_tolerance_m": 0.10,
        "angle_tolerance_deg": 2.0,
        "move_timeout_sec": 25.0,
        "rotate_timeout_sec": 15.0,
        "axis_aligned_moves": false,
        "heading_offset_deg": 0.0,
        "min_move_command_m": 0.05,
        "max_move_command_m": 1.0,
        "min_rotate_deg": 30.0,
        "max_rotate_deg": 150.0
    },
    "obstacle_avoidance": {
        "move_step_m": 0.25,
        "clearance_margin_m": 0.05,
        "obstacle_stop_distance_m": 0.25,
        "obstacle_lookahead_m": 1.2,
        "robot_radius_m": 0.18,
        "corridor_half_width_m": 0.20,
        "side_wall_min_m": 0.05,
        "side_wall_max_m": 0.80,
        "side_cone_deg": 60.0,
        "forward_scan_angle_deg": 140.0,
        "detour_scan_angle_deg": 120.0,
        "detour_angle_step_deg": 15.0,
        "detour_max_angle_deg": 90.0,
        "blocked_retry_wait_sec": 0.4,
        "max_blocked_retries": 25,
        "max_side_switches": 10,
        "start_min_clearance_m": 0.25,
        "rotate_timeout_tolerance_deg": 20.0,
        "min_valid_lidar_dist_m": 0.20
    },
    "path_planning": {
        "astar_grid_step_m": 0.05,
        "astar_max_nodes": 20000,
        "max_replans": 10
    },
    "rotation_primitives": {
        "_comment": "Motion primitives for discrete rotations - unified config",
        "_usage": "scale = correction factor, drift = expected x/y movement during rotation",
        "_note": "TEMPORARY: Quantization is executor-level. Phase 2 moves to planner.",
        "allowed_angles": [
            30,
            45,
            60,
            90,
            120,
            180
        ],
        "min_angle_threshold_deg": 15,
        "30": {
            "scale": 1.083,
            "min_duty_rotate": 0.56,
            "angular_k": 0.56,
            "drift_x_m": 0.018,
            "drift_y_m": 0.0
        },
        "45": {
            "scale": 0.98,
            "min_duty_rotate": 0.56,
            "angular_k": 0.56,
            "drift_x_m": 0.008,
            "drift_y_m": 0.0
        },
        "60": {
            "scale": 0.956,
            "min_duty_rotate": 0.56,
            "angular_k": 0.56,
            "drift_x_m": 0.004,
            "drift_y_m": 0.0
        },
        "90": {
            "scale": 0.962,
            "min_duty_rotate": 0.56,
            "angular_k": 0.56,
            "drift_x_m": 0.008,
            "drift_y_m": 0.0
        },
        "120": {
            "scale": 0.949,
            "min_duty_rotate": 0.56,
            "angular_k": 0.56,
            "drift_x_m": 0.010,
            "drift_y_m": 0.0
        },
        "180": {
            "scale": 0.961,
            "min_duty_rotate": 0.56,
            "angular_k": 0.56,
            "drift_x_m": 0.015,
            "drift_y_m": 0.0
        }
    },
    "stm32_params": {
        "_comment": "These are sent to STM32 via SET_PARAM on startup",
        "odom_scale": 0.89,
        "odom_angular_scale": 1.0,
        "linear_k": 1.0,
        "angular_k": 0.52,
        "max_speed": 0.8,
        "min_duty_linear": 0.45,
        "min_duty_rotate": 0.52,
        "min_duty_brake": 0.18,
        "move_kp": -0.0100,
        "move_ki": -0.00015,
        "move_kd": -0.0004,
        "move_min_pwm": 0.35,
        "move_max_pwm": 0.70,
        "move_smoothing": 0.3,
        "move_skew": 0.0080,
        "move_base_pwm": 0.65,
        "move_timeout": 20000,
        "rotate_tol_dist": 0.01,
        "rotate_tol_angle": 0.087,
        "rotate_timeout": 10000,
        "move_dist_tol_dist": 0.01,
        "move_dist_tol_angle": 0.05,
        "move_dist_timeout": 10000,
        "angular_rate_tol": 0.05
    }
}